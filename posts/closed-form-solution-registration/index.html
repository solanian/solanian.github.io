<!DOCTYPE html> <script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}}); </script> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> </script><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리" /><meta property="og:locale" content="en" /><meta name="description" content="이 논문들은 pointcloud registration의 조상격인 논문이다. 두 좌표계에 존재하는 point들의 registration 문제를 least square 문제로 바꿔서 iterative하게가 아닌 closed form으로 푸는 해법을 제시한 논문이라고 보면 된다." /><meta property="og:description" content="이 논문들은 pointcloud registration의 조상격인 논문이다. 두 좌표계에 존재하는 point들의 registration 문제를 least square 문제로 바꿔서 iterative하게가 아닌 closed form으로 푸는 해법을 제시한 논문이라고 보면 된다." /><link rel="canonical" href="https://solanian.github.io/posts/closed-form-solution-registration/" /><meta property="og:url" content="https://solanian.github.io/posts/closed-form-solution-registration/" /><meta property="og:site_name" content="I want to know everything" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-15T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-10T19:57:36+09:00","datePublished":"2020-12-15T00:00:00+09:00","description":"이 논문들은 pointcloud registration의 조상격인 논문이다. 두 좌표계에 존재하는 point들의 registration 문제를 least square 문제로 바꿔서 iterative하게가 아닌 closed form으로 푸는 해법을 제시한 논문이라고 보면 된다.","headline":"Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리","mainEntityOfPage":{"@type":"WebPage","@id":"https://solanian.github.io/posts/closed-form-solution-registration/"},"url":"https://solanian.github.io/posts/closed-form-solution-registration/"}</script><title>Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리 | I want to know everything</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="I want to know everything"><meta name="application-name" content="I want to know everything"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/academicons.css"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> </a></div><div class="site-title mt-3"> <a href="/">I want to know everything</a></div><div class="site-subtitle font-italic">academic notes, thoughts, reviews</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="https://drive.google.com/file/d/1rIuUuGCkeIdNCTUC6p3cKCzRFvuR7Fxk/view?usp=sharing" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>CURRICULUM VITAE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/solanian" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sorld0603','snu.ac.kr'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/dongseong-seo-64a3471aa" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://scholar.google.com/citations?user=B7-29akAAAAJ" aria-label="googlescholar" target="_blank" rel="noopener"> <i class="ai ai-google-scholar-square"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Closed-form solution of absolute orientation using unit quaternions, orthonormal matrices 정리</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1607958000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 15, 2020 </em> </span> <span> Updated <em class="" data-ts="1660129056" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 10, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/solanian">Dongseong Seo</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2990 words"> <em>16 min</em> read</span></div></div></div><div class="post-content"><p>이 논문들은 pointcloud registration의 조상격인 논문이다. 두 좌표계에 존재하는 point들의 registration 문제를 least square 문제로 바꿔서 iterative하게가 아닌 closed form으로 푸는 해법을 제시한 논문이라고 보면 된다.</p><p><img data-src="../../assets/img/Closed-form%20solution%20of%20absolute%20orientation%20using%20ce809651f45c409291d54e1dcc61f461/Untitled.png" alt="Closed-form%20solution%20of%20absolute%20orientation%20using%20ce809651f45c409291d54e1dcc61f461/Untitled.png" data-proofer-ignore></p><h1 id="closed-form-solution-of-absolute-orientation-using-unit-quaternions">Closed-form solution of absolute orientation using unit quaternions</h1><p>paper: <a href="https://www.researchgate.net/publication/230600780_Closed-Form_Solution_of_Absolute_Orientation_Using_Unit_Quaternions">Closed-form solution of absolute orientation using unit quaternions</a></p><p>여기서는 solution을 unit quaternion의 형태로 rotation을 표현하며 4x4 matrix의 최대 eigenvalue의 eigenvector가 desired quaternion이 된다. 본 논문에서는 source와 target을 left와 right coordinate라고 표현하였다.</p><ul><li><p>Method</p><p>앞으로 나오겠지만 scale factor와 translation은 rotation만 구하면 쉽게 구할 수 있으나 rotation을 구하는 것이 어렵다.</p><ul><li><p>Selective Discarding Constraints</p><p>여기서는 3개의 point를(논문에서는 triad라 표현) 사용하여 각각의 coordinate를 기준으로 이 point들의 coordinate를 계산하였다. 이 triad point들의 left와 right 좌표계에서의 표현을 $r_{l,1},r_{l,2},r_{l,3},r_{r,1},r_{r,2},r_{r,3}$라 나타내었다.</p>\[x_l=r_{l,2}-r_{l,1}, y_l=(r_{l,3}-r_{l,1})-[(r_{l,3}-r_{l,1})\cdot\hat{x_l}]\hat{x_l}, \hat{z_l}=\hat{x_l}\times\hat{y_l} \\ x_r=r_{r,2}-r_{r,1}, y_r=(r_{r,3}-r_{r,1})-[(r_{r,3}-r_{r,1})\cdot\hat{x_r}]\hat{x_r}, \hat{z_r}=\hat{x_r}\times\hat{y_r}\]<p>여기서 hat이 붙은 vector들은 unit vector이다. 그리고 이 column vector들을 합쳐서 matrix를 만드는데 다음과 같이 만든다.</p>\[M_l=|\hat{x_l}\hat{y_l}\hat{z_l}|, M_r=|\hat{x_r}\hat{y_r}\hat{z_r}|\]<p>그리고 left coordinate상에서의 vector $r_l$을 이 triad point들의 coordinate로 변환하면 $M_l^Tr_l$이 되고 여기에 $M_r$를 곱하면 이 값들을 right coordinate에 mapping이 된다. 따라서</p>\[r_r=M_rM_l^Tr_l\]<p>이 된다. 이를 통해 rotation은 다음과 같이 주어지는 것을 알 수 있다.</p>\[R=M_rM_l^T\]<p>$M_r,M_l$은 만드는 과정에서 알 수 있듯이 orthonormal이므로 $R$ 또한 orthonormal이 된다. 이런식으로 rotation을 구하는 것은 쉽지만 data가 완벽하지 않을 경우 어떤식으로 3개의 point를 선택하느냐에 따라서 rotation matrix가 달라지므로 3개 이상의 point에 대해서는 확장을 하기가 어렵다. 그래서 이를 보완한 optimum rotation을 구하는 방법은 추후에 소개한다고 한다.</p><li><p>Finding the Translation</p><p>n개의 point가 존재한다고 할때 left와 right coordinate 에서의 point를 다음과 같이 나타낸다고 하자.</p>\[\{r_{l,i}\},\{r_{r,i}\}\]<p>그리고 여기서 우리는 다음을 만족하는 transformation을 찾고자 한다.</p>\[r_r=sR(r_l)+r_0\]<p>여기서 $s$는 scale factor $r_0$는 translational offset, $R(r_l)$은 $r_l$을 rotation한다는 의미이다. 모든 rotation에 대해서 rotation matrix는 orthonormal이므로 다음을 만족한다.</p>\[||R(r_l)||^2=||r_l||^2\]<p>그리고 data가 완벽하지 않다면 최적의 transformation을 한다고 해도 residual error가 존재할 수밖에 없다. 이 residual error은 아래와 같이 나타낸다.</p>\[e_i=r_{r,i}-sR(r_{r,i})-r_0\]<p>그리고 이 residual error의 sum을 minimize하는 것이 registration 문제를 푸는 것과 같다.</p>\[\sum_{i=1}^{n}||e_i||^2\]<p>앞으로 우선은 translation에 대해서 그 다음은 scale 마지막으로 roataion에 대해서 total error가 달라지는 것을 살펴볼 것이다.</p><li><p>Centroids of the Sets of Measurements</p><p>각각의 coordinates 상의 point에 대해서 centroid $\bar{r_l},\bar{r_r}$를 계산하면 다음과 같다.</p>\[\bar{r_l}=\frac{1}{n}\sum_{i=1}^{n}r_{l,i}, \bar{r_r}=\frac{1}{n}\sum_{i=1}^{n}r_{r,i}\]<p>그리고 이 centroid들을 중심으로 새로운 coordinate를 정의하고 여기서 point들을 나타내면 다음과 같아진다.</p>\[r^{\prime}_{l,i}=r_{l,i}-\bar{r_l}, r_{r,i}^{\prime}=r_{r,i}-\bar{r_r} \\ \sum_{i=1}^{n}r_{l,i}^{\prime}=0, \sum_{i=1}^{n}r_{r,i}^{\prime}=0\]<p>그리고 residual error도 이 coordinate상으로 바꿔서 표현하면 다음과 같다.</p>\[e_i=r_{r,i}^{\prime}-sR(r_{l,i}^{\prime})-r_{0}^{\prime} \\ r_{0}^{\prime}=r_{o}-\bar{r_r}+sR(\bar{r_l}) \\ \sum_{i=1}^{n}||r_{r,i}^{\prime}-sR(r_{l,i}^{\prime})-r_{0}^{\prime}||^{2} \\ \sum_{i=1}^{n}||r_{r,i}^{\prime}-sR(r_{l,i}^{\prime})||^2-2r_{0}^{\prime}\cdot\sum_{i=1}^{n}[r_{r,i}^{\prime}-sR(r^{\prime}_{l,i})]+n||r_{0}^{\prime}||^2\]<p>여기서 두번째 term은 centroid를 중심으로 coordinate를 옮겼으므로 0이 될 것이고 첫번째 term의 경우 translation과 상관 없는 term이며 마지막 term은 non-negative이므로 translation에 대해서 $r_0^{\prime}=0$일때 total error가 minimize되며</p>\[r_0=\bar{r_r}-sR(\bar{r_l})\]<p>이 된다. 따라서 translation은 단순히 right centroid와 scaled, rotated left centroid 사이의 difference가 된다. 이 식은 scale과 rotation을 구한 이후에 translational offset을 구할때에 사용된다. 그리고 여기에서 $r_0^{\prime}=0$이므로 error term은 다음과 같이 나타낼 수 있다.</p>\[e_i=r_{r,i}^{\prime}-sR(r_{l,i}^{\prime}) \\ \sum_{i=1}^{n}||r_{r,i}^{\prime}-sR(r_{l,i}^{\prime})||^2\]<li><p>Finding the Scale</p><p>\(||R(r_{l,i}^{\prime})||^2=||r_{l,i}^{\prime}||\) 이므로 total error를 전개하면</p>\[\sum_{i=1}^{n}||r_{r,i}^{\prime}||^2-2s\sum_{i=1}^{n}r_{r,i}^{\prime}\cdot R(r_{l,i}^{\prime})+s^2\sum_{i=1}^{n}||r_{l,i}^{\prime}||^2\]<p>편의성을 위해 위의 식을 간단하게 나타내고 완전제곱식으로 바꾸면 다음과 같다.</p>\[S_r-2sD+s^2S_l \\ =(s\sqrt{S_l}-D/\sqrt{S_l})^2+(S_rS_l-D^2)/S_l\]<p>이 식을 minimize하기 위해서는 $s=D/S_l$이 되어야 한다.</p>\[s=\frac{\sum\limits_{i=1}^{n}r_{r,i}^{\prime}\cdot R(r_{l,i}^{\prime})}{\sum\limits_{i=1}^{n}||r_{l,i}^{\prime}||}\]<li><p>Symmetry in Scale</p><p>transformation은 inverse form의 형태로 대칭적으로 다음과 같이 나타낼 수 있다.</p>\[r_r=sR(r_l)+r_0 \\ r_l=\bar{s}\bar{R}(r_r)+\bar{r_0} \\ \bar{s}=1/s, \bar{r_0}=-\frac{1}{s}R^{-1}(r_0), \bar{R}=R^{-1}\]<p>inverse transform에 대해서 위와 같은 식으로 $\bar{s}=\bar{D}/S_r$을 찾아서 구하게 되면 $\bar{s}\neq 1/s$ 가 된다. 그 이유는 위의 방식으로 하면 구해지는 scale이 각각의 coordinate에서의 measurement에 depend하기 때문이다.</p><p>위의 두 결과가 asymmetric해도 한쪽의 presision이 다른쪽에 비해서 매우 높다면 적절한 결과를 얻은 것이지만 두 measurement에서의 eror가 유사하다면 다음과 같은 symmetric error term을 사용하는 것이 더 합리적이다.</p>\[e_i=\frac{1}{\sqrt{s}}r_{r,i}^{\prime}-\sqrt{s}R(r_{l,i}^{\prime})\]<p>위의 term을 사용하면 total error는 다음과 같아지며</p>\[\frac{1}{s}\sum_{i=1}^{n}||r_{r,i}^{\prime}||^2-s\sum_{i=1}^{n}r_{r,i}^{\prime}\cdot R(r_{l,i}^{\prime})+s\sum_{i=1}^{n}||r_{l,i}^{\prime}||^2 \\ =\frac{1}{s}S_r-2D+sS_l \\ =(\sqrt{s}S_l-\frac{1}{\sqrt{s}}S_r)^2+2(S_lS_r-D)\]<p>$s=S_r/S_l$일때 최소가 된다.</p>\[s=(\sum_{i=1}^{n}||r_{r,i}^{\prime}||^2/\sum_{i=1}^{n}||r_{l,i}^{\prime}||^2)^{1/2}\]<p>이 symmetrical result의 또 다른 장점은 rotation에 대해서 알 필요가 없이 scale을 구할 수 있다는 점이며 또한 scale의 결과가 rotation을 구하는데에 영향을 주지 않는다는 것이다. 그래서 결국 남은 error term을 minimize하기 위해서는 $D$를 maximize하는 rotation을 찾아야 한다. 즉 아래의 식을 maximize하는 rotation을 찾으면 된다.</p>\[\sum_{i=1}^{n}r_{r,i}^{\prime}\cdot R({r^{\prime}_{l,i})}\]<li><p>Finding the Best Rotation</p><p>우선 본 논문에서는 rotation representation으로 quaternion을 사용했는데 그 이유는 unit quaternion 이라는 constratint가 rotation matrix가 orthonormal이라는 constraint보다 간단하기 때문이라고 한다. 그리고 unit quaternion의 axis와 angle notation geometric 관점에서 더 직관적이기 때문이다.</p><p>위의 식을 quaternion notation으로 바꾸면 다음과 같다.</p>\[\sum_{i=1}^{n}(\dot{q}\dot{r^{\prime}_{l,i}\dot{q}^*})\cdot\dot{r}^{\prime}_{r,i}\]<p>이렇게 바꾸고 나면 위의 식을 maximize하는 unit quaternion $\dot{q}$를 찾는 문제가 된다. 그리고 이 식을 변형하면</p>\[\sum_{i=1}^{n}(\dot{q}\dot{r^{\prime}_{l,i}\dot{q}^*})\cdot\dot{r}^{\prime}_{r,i} \\ = \sum_{i=1}^{n}(\bar{Q}^{T}Q\dot{r}^{\prime}_{l,i})^T\dot{r}^{\prime}_{r,i} \\ =\sum_{i=1}^{n}(Q\dot{r}_{l,i}^{\prime})^T\bar{Q}\dot{r}^{\prime}_{r} \\ =\sum_{i=1}^{n}(\dot{q}\dot{r}^{\prime}_{l,i})\cdot(\dot{r}^{\prime}_{r,i}\dot{q}) \\ = \sum_{i=1}^{n}(\bar{\mathbb{R}}_{l,i}\dot{q})\cdot(\mathbb{R}_{r,i}\dot{q}) \\ = \sum_{i=1}^{n}\dot{q}^T\bar{\mathbb{R}}_{l,i}^T\mathbb{R}_{r,i}\dot{q} \\=\dot{q}^T(\sum_{i=1}^{n}\bar{\mathbb{R}}_{l,i}^T\mathbb{R}_{r,i})\dot{q} \\=\dot{q}^T(\sum_{i=1}^{n}N_i)\dot{q}\\=\dot{q}^TN\dot{q}\]<p>이고 여기서</p>\[\bar{\mathbb{R}}_{l,i}=\begin{bmatrix}0 &amp; -x_{l,i}^{\prime} &amp; -y^{\prime}_{l,i} &amp; -z^{\prime}_{l,i} \\ x^{\prime}_{l,i} &amp; 0 &amp; z^{\prime}_{l,i} &amp; -y^{\prime}_{l,i} \\ y^{\prime}_{l,i} &amp; -z^{\prime}_{l,i} &amp; 0 &amp; x^{\prime}_{l,i} \\ z^{\prime}_{l,i} &amp; y^{\prime}_{l,i} &amp; -x^{\prime}_{l,i} &amp; 0 \end{bmatrix},\ \mathbb{R}_{r,i} = \begin{bmatrix} 0 &amp; -x^{\prime}_{r,i} &amp; -y ^{\prime}_{r,i} &amp; -z^{\prime}_{r,i} \\ x^{\prime}_{r,i} &amp; 0 &amp; -z^{\prime}_{r,i} &amp; y^{\prime}_{r,i} \\ y^{\prime}_{r,i} &amp; z^{\prime}_{r,i} &amp; 0 &amp; -x^{\prime}_{r,i} \\ z^{\prime}_{r,i} &amp; -y^{\prime}_{r,i} &amp; x^{\prime}_{r,i} &amp; 0 \end{bmatrix} \\ N_i=\bar{\mathbb{R}}_{l,i}^T\mathbb{R}_{r,i},\ N=\sum_{i=1}^{n}N_i\]<p>이며 각각의 $N_i$들이 symmetric이므로 $N$ 또한 symmetric이다.</p><p>여기서 계산의 편리성을 위해서 다음과 같은 3$\times$3 matrix를 도입한다.</p>\[M=\sum_{i=1}^{n}r^{\prime}_{l,i}r^{\prime \ T}_{r,i} \\ M=\begin{bmatrix} S_{xx} &amp; S_{xy}&amp;S_{xz}\\ S_{yx}&amp;S_{yy}&amp;S_{yz}\\ S_{zx}&amp;S_{zy}&amp;S_{zz}\end{bmatrix},\ S_{xx}=\sum_{i=1}^{n}x^{\prime}_{l,i}x^{\prime}_{r,i}\]<p>그리고 이 matrix $M$의 성분들을 이용해 $N$을 표현하면 다음과 같다.</p>\[N=\begin{bmatrix}(S_{xx}+S_{yy}+S_{zz})&amp;S_{yz}-S_{zy}&amp;S_{zx}-S_{xz}&amp;S_{xy}-S_{yx}\\ S_{yz}-S_{zy} &amp; (S_{xx}-S_{yy}-S_{zz})&amp;S_{xy}+S_{yx}&amp;S_{zx}+S_{xz}\\ S_{zx}-S_{xz} &amp; S_{xy}+S_{yx}&amp;(-S_{xx}+S_{yy}-S_{zz})&amp;S_{yz}+S_{zy}\\ S_{xy}-S_{yx}&amp;S_{zx}+S_{xz}&amp;S_{yz}+S_{zy}&amp;(-S_{xx}-S_{yy}+S_{zz})\end{bmatrix}\]<p>이렇게 symmetric matrix $N$의 10개의 independent element를 $M$의 element를 이용해 나타낼 수 있으며 $Tr(N)=0$ 이다.</p><p>$N$은 4$\times$4 symmetric matrix이므로 4개의 real eigenvalue를 가지며 이를 크기 순으로 $\lambda_1,\lambda_2,\lambda_3,\lambda_4$라 하면 이와 관련된 unit eigenvector $\dot{e}_1,\dot{e}_2,\dot{e}_3,\dot{e}_4$에 대해서 다음을 만족한다.</p>\[N\dot{e}_i=\lambda_i\dot{e}_i,\ i=1,2,3,4\]<p>임의의 quaternion $\dot{q}$는 이 eigenvector를 이용해 다음과 같은 linear combination으로 나타낼 수 있으며</p>\[\dot{q}=\alpha_1\dot{e}_1+\alpha_2\dot{e}_2+\alpha_3\dot{e}_3+\alpha_4\dot{e}_4\]<p>이와 같은 식으로 $\dot{q}^TN\dot{q}$를 계산하면</p>\[N\dot{q}=\alpha_1\lambda_1\dot{e}_1+\alpha_2\lambda_2\dot{e}_2+\alpha_3\lambda_3\dot{e}_3+\alpha_4\lambda_4\dot{e}_4 \\ \dot{q}^TN\dot{q}=\dot{q}\cdot(N\dot{q})=\alpha_1^2\lambda_1+\alpha_2^2\lambda_2+\alpha_3^2\lambda_3+\alpha_4^2\lambda_4\]<p>그리고 eigenvalue를 크기순으로 $\lambda_1 \ge \lambda_2 \ge \lambda_3\ge\lambda_4$ 이렇게 정했으며 $\dot{q}$가 unit quaternion 이므로 다음을 만족한다.</p>\[\dot{q}^TN\dot{q}\le\alpha_1^2\lambda_1+\alpha_2^2\lambda_1+\alpha_3^2\lambda_1+\alpha_4^2\lambda_1=\lambda_1\]<p>따라서 $\dot{q}^TN\dot{q}$은 $N$의 가장 큰 eigenvalue $\lambda_1$보다 커질 수 없으며 이를 최대화 하기 위해서는 $\alpha_1=1,\ \alpha_2=\alpha_3=\alpha_4=0$이 되도록 해야 하므로 $\dot{q}=\dot{e}_1$이 residual error를 minimize하는 unit quaternion이 된다.</p><p>그리고 위에 구한 matrix들을 활용하여 이 eigenvector와 eigenvalue를 구하는 식은 다음과 같다.</p>\[\det(N-\lambda I)=0 \\ [N-\lambda_mI]\dot{e}_m=0\\\lambda^4+c_3\lambda^3+c_2\lambda^2+c_1\lambda+c_0=0\\c_3=0, c_2=-2Tr(M^TM),c_1=-8\det(M),c_0=\det(N)\]</ul></ul><h1 id="closed-form-solution-of-absolute-orientation-using-orthonormal-matrices">Closed-form solution of absolute orientation using orthonormal matrices</h1><p>paper: <a href="https://www.researchgate.net/publication/234136431_Closed-Form_Solution_of_Absolute_Orientation_using_Orthonormal_Matrices#:~:text=Closed-Form%20Solution%20of%20Absolute%20Orientation%20Using%20Unit%20Quaternions&amp;text=Finding%20the%20relationship%20between%20two%20coordinate%20systems%20using%20pairs%20of,in%20stereophotogrammetry%20and%20in%20robotics.">Closed-form solution of absolute orientation using orthonormal matrices</a></p><p>이 논문은 같은 저자가 1년뒤에 쓴 논문인데 앞에서 translation과 scale을 구하는 과정까지는 동일하며 rotation을 구하는 부분에서 quaternion representation 대신 orthonormal matrix representation을 사용해서 해결하였다. 따라서 앞부분은 생략하고 residual error를 minimize하기 위해서 maximize 해야하는 $D$를 다시 살펴보면 다음과 같다.</p>\[\sum_{i=1}^{n}r_{r,i}^{\prime}\cdot R({r^{\prime}_{l,i})}\]<ul><li><p>Dealing with Rodation</p><p>여기서 $a^TRb=Tr(R^Tab^T)$임을 이용하여(계산해보면 나온다) 위의 식을 정리하면</p>\[\sum_{i=1}^{n}r_{r,i}^{\prime}\cdot R({r^{\prime}_{l,i})}\\=\sum_{i=1}^{n}(r^{\prime}_{r,i})^TR(r_{l,i}^{\prime})\\=Tr\begin{bmatrix}R^T\sum\limits_{i=1}^{n}r^{\prime}_{r,i}(r^{\prime}_{l,i})^T\end{bmatrix}\\=Tr(R^TM)\]<p>이고 여기서 $M$은 앞의 unit quaternion에서 구한 $M$과 같다.</p>\[M=\sum_{i=1}^{n}r^{\prime}_{r,i}(r^{\prime}_{l,i})^T \\ M=\begin{bmatrix} S_{xx} &amp; S_{xy}&amp;S_{xz}\\ S_{yx}&amp;S_{yy}&amp;S_{yz}\\ S_{zx}&amp;S_{zy}&amp;S_{zz}\end{bmatrix},\ S_{xx}=\sum_{i=1}^{n}x^{\prime}_{r,i}x^{\prime}_{l,i}\]<p>여기서 $Tr(R^TM)$을 maximize하는 orthonormal matrix $R$을 찾으면 된다.</p><p>모든 square matrix는 orthonormal matrix $U$와 positive semidefinite matrix S로 decomposition할 수 있으며 matrix가 nonsingular라면 $U$가 uniquely determined 된다. 그래서 $M$이 nonsingular라면 다음과 같이 나타낼 수 있다.</p>\[M=US\\S=(M^TM)^{1/2},\ U=M(M^TM)^{-1/2},\ S^T=S,\ U^TU=I\]<ul><li><p>Symmetric matrix $S$</p><p>우선 $M^TM$을 eigenvalue와 eigenvector를 이용해 표현하면 다음과 같다.</p>\[M^TM=\lambda_1\hat{u}_1\hat{u_1}^T+\lambda_2\hat{u}_2\hat{u_2}^T+\lambda_3\hat{u}_3\hat{u_3}^T\]<p>그리고 $M^TM$은 positive definite이므로 eigenvalue들이 positive이므로 eigenvalue의 square root들은 real value이며 다음과 같은 symmetric matrix $S$는 다음과 같이 나타낼 수 있다.</p>\[S=\sqrt{\lambda_{1}}\hat{u}_1\hat{u}_1^T+\sqrt{\lambda_{2}}\hat{u}_2\hat{u}_2^T+\sqrt{\lambda_{3}}\hat{u}_3\hat{u}_3^T\]<p>$S^2=M^TM$임은 쉽게 알 수 있다. 그리고 $S$ 또한 positive definite 임은 다음과 같은 식으로 알 수 있다.</p>\[x^TSx=\sqrt{\lambda_1}(\hat{u}_1\cdot x)^2+\sqrt{\lambda_2}(\hat{u}_2\cdot x)^2+\sqrt{\lambda_3}(\hat{u}_3\cdot x)^2 &gt; 0\]<li><p>Orthonormal matrix U</p><p>모든 eigenvalue가 positive라면 다음과 같이 나타낼 수 있다.</p>\[S^{-1}=(M^TM)^{-1/2}=\frac{1}{\sqrt{\lambda_1}}\hat{u}_1\hat{u}_1^T + \frac{1}{\sqrt{\lambda_2}}\hat{u}_2\hat{u}_2^T + \frac{1}{\sqrt{\lambda_3}}\hat{u}_3\hat{u}_3^T\]<p>그리고 다음과 같은 식으로 $U$을 구할 수 있다.</p>\[U=MS^{-1}=M(M^TM)^{-1/2}\]<p>여기에 determinant를 적용하면</p>\[\det(U)=\det(MS^{-1})=\det(M)\det(S^{-1})\]<p>$\det(S^{-1})&gt;0$ 이므로 $\det(U)$와 $\det(M)$의 부호는 같으며 $\det(M)&gt;0$ 이면 순수 rotation을 나타내고 $\det(M)&lt;0$ 이면 reflection이 포함된 rotation을 나타낸다. 여기서는 data에 대해 rotation만 일어난다고 가정한다.</p><p>그리고 만약 $M$의 rank가 2라면 위의 방식으로 orthonormal matrix를 구할 수 없다. 그래서 대신 다음과 같은 식으로 구한다.</p>\[U=M\begin{pmatrix}\frac{1}{\lambda_1}\hat{u}_1\hat{u}_1^T+\frac{1}{\lambda_2}\hat{u}_2\hat{u}_2^T\end{pmatrix}\pm\hat{u}_3\hat{u}_3^T\]<p>$\hat{u}_3$는 eigenvalute가 0인 eigenvector이다. 그리고 마지막 term의 부호는 $\det(U)$가 positive가 되도록 정한다.</p></ul><p>다시 본론으로 돌아와 maximize하려는 값은 $Tr(R^TM)$이며 위의 decomposition을 적용하고 식을 정리하면 다음과 같다.</p>\[Tr(R^TM)=Tr(R^TUS)\\=\sqrt{\lambda_1}Tr(R^TU\hat{u}_1\hat{u}_1^T) + \sqrt{\lambda_2}Tr(R^TU\hat{u}_2\hat{u}_2^T) + \sqrt{\lambda_3}Tr(R^TU\hat{u}_3\hat{u}_3^T)\]<p>그리고 trace는 commutative property를 만족하므로</p>\[Tr(R^TU\hat{u}_i\hat{u}_i^T)=Tr(\hat{u}_i^TR^TU\hat{u_i})=Tr(R\hat{u}_i\cdot U\hat{u}_i)=(R\hat{u}_i\cdot U\hat{u}_i)\]<p>이며 $R,U$는 orthonormal이므로 $(R\hat{u}_i\cdot U\hat{u}_i)\le1$ 이며 equality가 성립하는 경우는 $R\hat{u}_i=U\hat{u}_i$ 일 때이다. 따라서 다음과 같은 식이 성립하며</p>\[Tr(R^TUS)\le\sqrt{\lambda_1}+\sqrt{\lambda_2}+\sqrt{\lambda_3}=Tr(S)\]<p>$Tr(R^TUS)$의 maximum value는 $R^TU=I, R=U$가 되도록 $R$을 구함으로써 얻을 수 있다. 그래서 $M$이 nonsingular라면 우리가 구하고자 하는 orthonormal matrix $R$은</p>\[R=M(M^TM)^{-1/2}\]<p>이다. $M$의 rank가 2라면 위에서 구한 방법대로 $R=U$로 구하면 된다.</p><ul><li><p>Nearest Orthonormal Matrix</p><p>여기서는 $M$에 대해서 nearest orthonormal matrix $R$이 $U$와 같다는 것을 보인다. 이는 아래의 식을 minimize하는 $R$을 구한다는 것과 같다.</p>\[\sum_{i=1}^{3}\sum_{j=1}^{3}(m_{i,j}-r_{i,j})^2=Tr[(M-R)^T(M-R)] \\=Tr(M^TM)-2Tr(R^TM)+Tr(R^TR)\\ R^TR=I\]<p>여기서 첫번째 term과 세번째 term은 $R$과 상관없는 term이므로 이 문제는 결국 $Tr(R^TM)$을 maximize하는 $R$을 찾는 문제와 같아지고 우리가 이제껏 풀었던 문제와 같은 문제이다.</p><p>이를 통해서 residual error를 minimize하는 orthonormal matrix는 원래의 matrix $M$에 가장 가까운 orthonormal matrix를 찾는 least-square 문제와 같다는 것을 알 수 있다.</p><li><p>Symmetry in the Transformation</p><p>left to right가 아닌 right to left transformation을 찾고 싶다면 다음 식을 maximize하는 rotation을 찾아야 한다.</p>\[\sum_{i=1}^{n}(r_{l,i}^{\prime})^T\bar{R}r_{r,i}^{\prime}\]<p>앞에서 구한 rotation의 대칭성을 이용하면 바로 다음처럼 구할 수 있다.</p>\[\bar{R}=M^T(MM^T)^{-1/2}\]<p>여기서 $\bar{R}^T=R$이 되어야하는데</p>\[\bar{R}^T=(MM^T)^{-1/2}M \\ R=M(M^TM)^{-1/2}\]<p>위의 두 식이 달라보이지만</p>\[[M^{-1}(MM^T)^{-1/2}M]^2=M^{-1}(MM^T)^{-1}M=(M^TM)^{-1}\\ M^{-1}(MM^T)^{-1/2}M=(M^TM)^{-1/2} \\ (MM^T)^{-1/2}M=M(M^TM)^{-1/2}\]<p>으로 같음을 알 수 있다.</p></ul><p>위의 정보들을 바탕으로 실제로 rotation을 구하는 식은 다음과 같다.</p>\[M^TM=\begin{bmatrix}a &amp; d&amp; f \\ d&amp; b&amp; e \\ f&amp; e&amp; c\end{bmatrix}\\\det(M^TM-\lambda I)=0\\(M^TM-\lambda_i I)\hat{u}_i=0\\-\lambda^3+d_2\lambda^2+d_1\lambda+d_0=0\\d_2=Tr(M^TM)\\d_1=(e^2-bc)+(f^2-ac)+(d^2-ab)\\d_0=[\det(M)]^2\]</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pointcloud-registration/'>Pointcloud Registration</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pointcloud/" class="post-tag no-text-decoration" >Pointcloud</a> <a href="/tags/rigid/" class="post-tag no-text-decoration" >Rigid</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Closed-form+solution+of+absolute+orientation+using+unit+quaternions%2C+orthonormal+matrices+%EC%A0%95%EB%A6%AC+-+I+want+to+know+everything&url=https%3A%2F%2Fsolanian.github.io%2Fposts%2Fclosed-form-solution-registration%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Closed-form+solution+of+absolute+orientation+using+unit+quaternions%2C+orthonormal+matrices+%EC%A0%95%EB%A6%AC+-+I+want+to+know+everything&u=https%3A%2F%2Fsolanian.github.io%2Fposts%2Fclosed-form-solution-registration%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsolanian.github.io%2Fposts%2Fclosed-form-solution-registration%2F&text=Closed-form+solution+of+absolute+orientation+using+unit+quaternions%2C+orthonormal+matrices+%EC%A0%95%EB%A6%AC+-+I+want+to+know+everything" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/why_devcontainer/">Why devcontainer?</a><li><a href="/posts/review-detr/">DETR에서 PETRv2 까지</a><li><a href="/posts/region-growing-segmentation/">Region Growing Segmentation 정리</a><li><a href="/posts/stand_alone_self_attention/">Stand-Alone Self-Attention in Visual Models 정리</a><li><a href="/posts/A_comprehensive_review_of_3D_point_cloud_descriptors/">3D pointcloud descriptors 총 정리</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/pointcloud/">Pointcloud</a> <a class="post-tag" href="/tags/slam/">SLAM</a> <a class="post-tag" href="/tags/vision/">Vision</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/model/">Model</a> <a class="post-tag" href="/tags/rigid/">Rigid</a> <a class="post-tag" href="/tags/calibration/">calibration</a> <a class="post-tag" href="/tags/diffusion/">Diffusion</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/icp/"><div class="card-body"> <em class="small" data-ts="1607180400" data-df="ll" > Dec 6, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ICP(Iterative Closest Point) Algorithm 정리</h3><div class="text-muted small"><p> Reference: Least-Squares Fitting of Two 3-D Point Sets ICP 알고리즘은 fine registration에서 거의 가장 기본이 되는 알고리즘이라고 볼 수 있다. ICP 알고리즘의 과정 자체는 복잡하지 않은데 늘 이해가 안됐던 부분이 center point로 translation을 한 이후에 두 frame...</p></div></div></a></div><div class="card"> <a href="/posts/region-growing-segmentation/"><div class="card-body"> <em class="small" data-ts="1627052400" data-df="ll" > Jul 24, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Region Growing Segmentation 정리</h3><div class="text-muted small"><p> Reference: https://pcl.readthedocs.io/projects/tutorials/en/latest/region_growing_segmentation.html PCL에서 사용되는 Region Growing Segmentation의 방법론을 pcl 공식 문서를 참조하여 정리하였다. Algorithm 개요 ...</p></div></div></a></div><div class="card"> <a href="/posts/pointnet_pointnetpp/"><div class="card-body"> <em class="small" data-ts="1544022000" data-df="ll" > Dec 6, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PointNet, PointNet++ 정리</h3><div class="text-muted small"><p> PointNet paper: PointNet: Deep Learning on Point Sets for 3D Classification and Segmentation code: https://github.com/charlesq34/pointnet point cloud는 geometric data 구조중에서 중요한 type이지만 unordered라...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/icp/" class="btn btn-outline-primary" prompt="Older"><p>ICP(Iterative Closest Point) Algorithm 정리</p></a> <a href="/posts/lidar_iris/" class="btn btn-outline-primary" prompt="Newer"><p>LiDAR IRIS 정리</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/solanian">Dongseong Seo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/pointcloud/">Pointcloud</a> <a class="post-tag" href="/tags/slam/">SLAM</a> <a class="post-tag" href="/tags/vision/">Vision</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/model/">Model</a> <a class="post-tag" href="/tags/rigid/">Rigid</a> <a class="post-tag" href="/tags/calibration/">calibration</a> <a class="post-tag" href="/tags/diffusion/">Diffusion</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
